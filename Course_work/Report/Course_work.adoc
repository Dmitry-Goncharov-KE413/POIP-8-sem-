:description: Course_work
:keywords: AsciiDoc
:imagesdir: CourseworkImg
:figure-caption: Рисунок
:table-caption: Таблица
= Курсовой проект
:toc:


МИНИСТЕРСТВО НАУКИ И ВЫСШЕГО ОБРАЗОВАНИЯ РОССИЙСКОЙ ФЕДЕРАЦИИ +
Федеральное государственное автономное образовательное учреждение высшего образования +
«Южно-Уральский государственный университет» +
(национальный исследовательский университет) +
Высшая школа электроники и компьютерных наук +
Кафедра «Информационно-измерительная техника» +

Курсовой проект по дисциплине «Программное обеспечение измерительных процессов» +

Выполнили: +
студенты группы КЭ-413 +
Гончаров Д.А. +
Хайдарзода Ш.Н.


== Аннотация

В курсовом проекте была проведена разработка устройства управления яркостью светодиода,
осуществляемого посредством измерения напряжения, генерируемого переменным резистором,
установленного на плате расширения, с использованием ШИМ и прямого доступа к памяти (DMA),
выводом полученных значений напряжения на дисплей с электронными чернилами и передающей данных
через модуль BlueTooth Bee HC-06. +

Требования к разработке: +

. Для разработки должна использоваться отладочная XNUCLEO-F411RE. +
. Программное обеспечение должно измерять напряжение с переменного резистора,
установленного на плате расширения: +
* для измерения напряжения должен использоваться встроенный аналого-цифровой
преобразователь (АЦП);
* период измерения должен составлять 50 мс;
* для измерения напряжения должна использоваться плата расширения Accessories Shield;
* точность измерения напряжения должна быть не менее 0,01 В;
* измерения должны проводиться с помощью прямого доступа к памяти (DMA).
* к измеренному напряжению должен быть применен цифровой фильтр вида: +
[stem]
++++
tau = int([1-exp(-dt/(R*C)), R*C > 0 с], (1, R*C<=0 с));
++++
FilteredValue = OldFiltered + (Value - OldValue)*tau,

где dt = 100 мс;
    FilteredValue – текущее отфильтрованное значение напряжения; +
    Value – текущее нефильтрованное измеренное значение напряжения; +
    OldValue – предыдущее фильтрованное значение напряжения.

. Для управления яркостью светодиода, являющегося объектом управления и находящегося на
порту С.8 должен использоваться модуль PWM (ШИМ). +
. Передача значений по беспроводному интерфейсу должна осуществляться через
модуль BlueTooth Bee HC-06 или I/O Expansion Shield. +
* общение с платой расширения должно осуществляться через USART2;
* формат вывода измеренных значений напряжения на индикатор с электронными чернилами: +
"Напряжение: " X.XXX [Units] +
. Архитектура должна быть представлена в виде UML-диаграмм, созданных в пакете StarUML. +
. Приложение должно быть написано на языке C++ с использованием компилятора ARM 9.30.2.
. При разработке должна использоваться Операционная Система Реального Времени FREERTOS
и C++ обертка над ней. +

Оформление пояснительной записки к курсовому проекту осуществлено в соответствии с СТО ЮУрГУ 04-2008.

== Введение
Микропроцессорные системы, зарождением эпохи которых стало создание компанией Intel в 1971
году первой программируемой электронной схемы, как и микроконтроллеры, объединяя в себе
достижения вычислительной и микроэлектронной техники, получили широкое применение в
системах измерительной техники различной направленности. +
Развитие микроконтроллеров направлено по пути наращивания их вычислительных возможностей
встроенных средств ввода-вывода информации при одновременном удешевлении. Однако несмотря
на это, начиная с 70-х гг. XX века, принципы построения микроконтроллеров без значительны
изменений сохраняются до настоящего времени. +
На сегодняшний день среди разработчиков микроэлектронной аппаратуры большую популярность
получили микроконтроллеры швейцарской компании STMicroelectronics, имеющие ряд преимуществ
перед существующими аналогами в качестве сохранения совместимости pin-to-pin, т.е.
возможности замены текущего устройства на более современную модель. +

Целью курсового проекта является разработка электронного устройства управления яркостью светодиода.

Задачи курсового проекта:

* необходимо разработать архитектуру программного обеспечения (ПО) в виде диаграммы UML; +
* для ПО необходимо разработать код, соответствующий стандарту кодирования Стэнфордского университета;
* работа программы должна быть продемонстрирована совместно с платой XNUCLEO-F411RE; +
* содержание работы должно соответствовать ГОСТ 19.402-78 «Единая система программной документации.
Описание программы»; +
* описание архитектуры в виде UML-диаграмм должно быть оформлено в разделе «Описание логической
структуры» -> «Алгоритм программы»; +
* дополнительно к архитектуре, в разделе «Описание логической структуры» -> «Структура программы с
описанием функций составных частей и связи между ними», должен быть описан принцип работы программы
и взаимодействия разных ее блоков друг с другом. +


== Отладочная плата XNUCLEO-F11RE
Отладочная плата, изготовленная на основе микроконтроллера STM32F411RE, – гибкая платформа, предоставляющая
пользователю возможности расширения функций посредством использования плат расширения для Arduino
и ST Morpho. Общий вид отладочной платы XNUCLEO-F11RE приведен на рисунке 1.

.Общий вид отладочной платы XNUCLEO-F11RE
image::XNUCLEO-F411RE.PNG[]

== Плата расширения Accessory Shield
Accessory Shield — тип плат расширения, совместимых с развитыми платформами, предназначенными для
разработки электронных приложений: Arduino UNO, Arduino Leonardo, NUCLEO, XNUCLEO и совместимыми. На плате
установлены одни из наиболее распространенных блоков, подходящих для реализации большинства задач.
Общий вид платы расширения Accessory Shield представлен на рисунке 2.

.Общий вид платы расширения Accessory Shield
image::Accessory Shield.PNG[]

== Использование потенциометров (переменных резисторов)
Потенциометры, являющиеся отдельным видом резисторов, имеют свойство изменения своего электрического
сопротивления посредством регулирования с помощью механического воздействия на регулировочный орган,
приведенный на рисунке 3.

.Потенциометр (переменный резистор)
image::Potentiometer.PNG[]

В свою очередь, на используемой в курсовом проекте плате расширения Accessory Shield установлен переменный
резистор номиналом 10 кОм, подключаемый к каналу А0 платы. Схема подключения потенциометра к плате
расширения, созданная в САПР-программе Altium Designer, представлена на рисунке 4.

.Схема подключения потенциометра к Accessory Shield
image::Scheme_potentiometer.PNG[]

== Операционные системы реального времени
Операционные системы реального времени, ОСРВ (от англ. _Real Time Operating Systems_, *RTOS*) – специально
созданные ПО, имеющие широкое распространение в областях с необходимостью единовременного выполнения
большого количества задач и обеспечения интерфейса (обертки) к ресурсам критических по времени систем
реального времени.

Основной задачей сферы распространения ОСРВ является эффективное управление временем проведения различных
процессов производства с функцией очередности: быстрое выполнение более приоритетных задач и меньшее
по скорости осуществление менее важных запросов.

Пример реализации выполнения в ОСРВ задач различных приоритетов изображен на рисунке 5.

.Схема подключения потенциометра к Accessory Shield
image::Example_of_RTOS.PNG[]

== Анализ требований
Согласно техническому заданию, в курсовом проекте необходимо разработать электронное устройство управления
яркостью одного светодиода на базе микроконтроллера STM32F411RE на отладочной плате XNUCLEO-F411RE с платой
расширения Accessory Shield.

Составим определенную последовательность действий к выполнению для достижения поставленной цели: +

. Подача тактирования на необходимые порты отладочной платы и платы расширения. +
. Настройка порта С.8, на котором расположен объект управления (ОУ), в альтернативный режим, и
порта А0 – в аналоговый режим вследствие необходимости в осуществлении измерения аналогового
сигнала напряжения. +
. Назначение каналов таймеров и их настройка ввиду требований к заданию периода измерений
выходного напряжения. +
. Подключение и настройка канала генерации широтно-импульсной модуляции (ШИМ). +
. Запуск таймера в рабочее состояние.

Рассмотрим каждый пункт представленного выше алгоритма анализа требований более подробно.

=== Подача тактирования на порты
Приведем на рисунках 6–11 все используемые в работе порты для последующей подачи на них тактирования,
реализованной в программном коде.

.Настройка подачи тактирования на порт C
image::GPIOCEN.PNG[]

.Настройка подачи тактирования на порт A
image::GPIOAEN.PNG[]

.Настройка подачи тактирования на АЦП
image::ADC1EN.PNG[]

.Настройка подачи тактирования на канал DMA
image::DMA1EN_DMA2EN.PNG[]

.Настройка подачи тактирования на модуль USART
image::USART2EN.PNG[]

.Настройка подачи тактирования на таймер TIM2
image::TIM2EN.PNG[]

.Настройка подачи тактирования на таймер TIM3
image::TIM3EN.PNG[]

=== Настройка портов для ОУ и потенциометра
Представим на рисунке 13 пример настройки порта А0 в аналоговый режим, а порта С.8 – в альтернативный режим.

.Настройка портов ОУ и потенциометра
image::A0_analog_C8_alternate.PNG[]

=== Назначение каналов таймера
Для задания значения периода измерения выходного сигнала напряжения будет использоваться таймер общего
назначения TIM3. Настройка каналов для данного таймера осуществляется с помощью регистров AFRL (для портов с
номерами от 0 до 7) и AFRH (для портов с номерами от 8 до 15), представленных на рисунках 14 и 15.

.Настройка каналов для таймера в регистре AFRL
image::AFRL.PNG[]

.Настройка каналов для таймера в регистре AFRL
image::AFRH.PNG[]

=== Подключение и настройка канала ШИМ
Следующим шагом в анализе требований является настройка канала ШИМ. Установим таймер, использующийся для
одного канала вследствие управления одним светодиодом, в режим захвата (рисунок 16).

.Настройка канала таймера в режим захвата
image::TIM_Capture.PNG[]

=== Запуск таймера в рабочее состояние
Установка таймера захвата для канала ШИМ в рабочее состояние приведена на рисунке 17.

.Настройка канала таймера в режим захвата
image::TIM_work_condition.PNG[]

== Архитектура проекта